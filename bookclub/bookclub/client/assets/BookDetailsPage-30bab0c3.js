import{y as T,k as r,_ as we,B as ye,M as pe,u as xe,f as D,g as v,z,D as Be,r as J,o as a,c as n,a as e,t as _,j as Re,E as p,G as L,F as x,h as P,i as w,x as S,H as Ce,I as K,b as M,w as V,J as g,P as d,K as N,v as Q,L as W,p as De,e as Pe}from"./index-174f9162.js";class A{constructor(t){this.id=t.id,this.gbId=t.gbId,this.creatorId=t.creatorId,this.content=t.content,this.rating=t.rating,this.creator=t.creator,this.createdAt=new Date(t.createdAt),this.updatedAt=new Date(t.updatedAt)}}class Ie{async setBookDetailsPageReviews(t){const s=(await T.get(`api/bookReviews?gbId=${t}`)).data;r.bookDetailsPage.userReviews=s.map(m=>new A(m))}async createBookReview(t){const k=await T.post("api/bookReviews",t),s=new A(k.data);return r.bookDetailsPage.userReviews.unshift(s),s}async updateBookReview(t){const k=await T.put(`api/bookReviews/${t.id}`,t),s=new A(k.data),m=r.bookDetailsPage.userReviews.find(B=>B.id==s.id);r.bookDetailsPage.userReviews.splice(m,1,s)}async deleteBookReview(t){await T.delete(`api/bookReviews/${t}`);const k=r.bookDetailsPage.userReviews.findIndex(s=>s.id==t);r.bookDetailsPage.userReviews.splice(k,1)}}const F=new Ie;const Ue={components:{BookClubCard:ye,ModalBasic:pe},setup(){const f=xe();let t=f.params.gbId;const k=D({rating:0,status:"planned"}),s=D("reviews"),m=D({gbId:t,rating:null,content:null}),B=D(!1),R=D(!0),C=D({}),o=v(()=>r.account),u=v(()=>r.user),b=v(()=>r.bookDetailsPage.book),h=v(()=>r.bookDetailsPage.userBook),I=v(()=>!!r.bookDetailsPage.userBook),X=v(()=>r.bookDetailsPage.userCreatorAdminClubs),O=v(()=>r.bookDetailsPage.userReviews),Y=v(()=>r.bookDetailsPage.clubs.planned),Z=v(()=>r.bookDetailsPage.clubs.reading),$=v(()=>r.bookDetailsPage.clubs.finished),ee=v(()=>Number(r.bookDetailsPage.bookScore).toFixed(2)),se=v(()=>r.bookDetailsPage.bookScoreUserCount),te=v(()=>r.bookDetailsPage.userBook?r.bookDetailsPage.userBook.rating:0),oe=v(()=>r.bookDetailsPage.userBook?r.bookDetailsPage.userBook.status:"planned"),ie=[{rating:1,description:"Horrendous"},{rating:2,description:"Terrible"},{rating:3,description:"Bad"},{rating:4,description:"Meh"},{rating:5,description:"Average"},{rating:6,description:"Good"},{rating:7,description:"Very Good"},{rating:8,description:"Great"},{rating:9,description:"Outstanding"},{rating:10,description:"Masterpiece"}];async function ae(){try{await g.setBookDetailsPageBook(t),await j(),await E()}catch(i){d.error(i.message)}}async function j(){try{await g.setBookScore(t)}catch(i){d.error(i.message)}}async function E(){try{await F.setBookDetailsPageReviews(t),U()}catch(i){d.error(i.message)}}async function ne(){await H(),await q(),await ce(),U()}async function H(){try{await g.setBookDetailsPageUserBooks(),await q()}catch(i){d.error(i.message)}}async function q(){try{g.setBookDetailsPageUserBook(t),k.value.rating=h.value?h.value.rating:"null",k.value.status=h.value?h.value.status:"null"}catch(i){d.error(i.message)}}async function ce(){try{await Q.setBookDetailsPageUserClubs(u.value.id)}catch(i){d.error(i.message)}}function U(){if("id"in u.value)try{const i=O.value.filter(l=>l.gbId==t&&l.creatorId==u.value.id);R.value=!!i.length}catch(i){d.error(i.message)}}async function le(){try{await g.updateUserBook(h.value.id,{rating:k.value.rating}),j(),d.toast("Rating updated successfully","success")}catch(i){d.error(i.message)}}async function de(){try{await g.updateUserBook(h.value.id,{status:k.value.status}),d.toast("Progress updated successfully","success")}catch(i){d.error(i.message)}}async function re(){C.value.My={bookListType:"user",bookId:I.value?h.value.id:"",existsInBookList:I.value,selected:I.value},X.value.forEach(async i=>{const l=await ue(i);C.value[i.name]={bookListType:"club",bookId:l?l.id:"",clubId:i.id,existsInBookList:!!l,selected:!!l}}),N.getOrCreateInstance("#bookLists").show()}async function ue(i){const l=await g.getBooksByClubId(i.id);if(!l)return null;const y=l.find(fe=>fe.gbId==t);return y||null}async function _e(){for(const[i,l]of Object.entries(C.value))try{switch(l.bookListType){case"user":l.selected&&!l.existsInBookList?(await g.createUserBook(b.value),d.toast(`Added to ${i} Books successfully`,"success")):!l.selected&&l.existsInBookList&&(await d.confirm(`Are you sure you want to remove this book from ${i} Books?`)?(await g.deleteUserBook(l.bookId),d.toast(`Removed from ${i} Books successfully`,"success")):l.selected=!0),await H();break;case"club":if(l.selected&&!l.existsInBookList){const y={clubId:l.clubId,gbId:b.value.gbId,title:b.value.title,imgUrl:b.value.imgUrl,author:b.value.author,rating:0,status:"planned"};await g.createClubBook(y),d.toast(`Added to ${i} Books successfully`,"success")}else!l.selected&&l.existsInBookList&&(await d.confirm(`Are you sure you want to remove this book from ${i} Books?`)?(await g.deleteClubBook(l.bookId),d.toast(`Removed from ${i} Books successfully`,"success")):l.selected=!0);break}}catch(y){d.error(y.message)}N.getOrCreateInstance("#bookLists").hide()}async function be(){try{const i=await F.createBookReview(m.value);m.value=i,U()}catch(i){d.error(i.message)}}function ve(i){m.value=i,B.value=!0}async function ke(){try{await F.updateBookReview(m.value),B.value=!1,d.toast("Book Review updated successfully","success")}catch(i){d.error(i.message)}}async function he(i){try{if(!await d.confirm("Are you sure you want to delete this review?"))return;await F.deleteBookReview(i.id),U()}catch(l){d.error(l.message)}}async function G(i){s.value=i,s.value=="reviews"?await E():await ge(i)}async function ge(i){try{await Q.setBookDetailsPageClubs(t,i)}catch(l){d.error(l.message)}}function me(){try{g.clearBooks()}catch(i){d.error(i.message)}}return z(async()=>{u.value.id&&await ne()}),z(async()=>{t=f.params.gbId,await ae(),await G("reviews")}),Be(()=>{me()}),{book:b,account:o,user:u,userBook:h,userBookRating:te,userBookStatus:oe,userHasThisBook:I,bookScore:ee,bookScoreUserCount:se,userBookData:k,userReviews:O,userReviewedStatus:R,clubsPlanned:Y,clubsReading:Z,clubsFinished:$,selectedTab:s,reviewData:m,bookListsOptions:C,reviewEditMode:B,ratingOptions:ie,updateUserBookRating:le,updateUserBookStatus:de,openBookListsModal:re,updateBookLists:_e,createReview:be,editReview:ve,updateReview:ke,deleteReview:he,selectTab:G}}},c=f=>(De("data-v-60bcfc2c"),f=f(),Pe(),f),Te={class:"container-fluid"},Le={class:"row"},Se={class:"col-12"},Me={key:0,class:"row mt-4"},Fe={class:"col-5 d-flex justify-content-center"},Ve=["src"],Ae={class:"col-7 h-100"},Oe={class:"d-flex flex-column h-100"},je={class:"fs-2 fw-bold"},Ee={class:"fs-5 fw-bold"},He={class:"fs-5"},qe={class:"mt-2 d-flex justify-content-between"},Ge={class:"text-center me-1 mb-2"},ze=c(()=>e("div",{class:"text-light light-blue-bg rounded px-2"},"Score",-1)),Je={class:"fw-bold"},Ke={key:0,class:"text-muted"},Ne={key:1,class:"fw-bold text-muted"},Qe={key:0},We={class:"d-flex justify-content-around"},Xe={key:0,class:"text-center pe-2"},Ye=c(()=>e("div",{class:"text-light light-blue-bg rounded px-2"},"My Rating",-1)),Ze=c(()=>e("option",{value:"0"},"Not Rated",-1)),$e=["value"],es={key:1,class:"text-center pe-2"},ss=c(()=>e("div",{class:"text-light light-blue-bg rounded px-2"},"Progress",-1)),ts=c(()=>e("option",{value:"planned"},"Plan To Read",-1)),os=c(()=>e("option",{value:"reading"},"Currently Reading",-1)),is=c(()=>e("option",{value:"finished"},"Finished",-1)),as=[ts,os,is],ns={class:"d-flex justify-content-around"},cs={class:"me-2"},ls=c(()=>e("div",{class:"d-flex align-items-center"},[e("i",{class:"mdi mdi-list-status fs-5 pe-2"}),e("div",null,"Lists")],-1)),ds=[ls],rs={class:"description-section"},us=c(()=>e("div",{class:"mt-2 fs-5 fw-bold"},"Description",-1)),_s=["innerHTML"],bs={class:"row mt-3 g-1"},vs={class:"col-3 text-center selectable"},ks={class:"col-3 text-center selectable"},hs={class:"col-4 text-center selectable"},gs={class:"col-2 text-center selectable"},ms={class:"row"},fs={class:"col-12"},ws={class:"dark-blue-bg p-2"},ys={key:0,class:"bg-dark"},ps={key:0},xs=c(()=>e("div",{class:"p-2"},"There are no clubs currently reading this book.",-1)),Bs=[xs],Rs={key:1,class:"row py-2"},Cs={key:1,class:"bg-dark"},Ds={key:0},Ps=c(()=>e("div",{class:"p-2"},"There are no clubs planning to read this book.",-1)),Is=[Ps],Us={key:1,class:"row py-2"},Ts={key:2,class:"bg-dark"},Ls={key:0},Ss=c(()=>e("div",{class:"p-2"},"There are no clubs finished reading this book.",-1)),Ms=[Ss],Fs={key:1,class:"row py-2"},Vs={key:3,class:"bg-dark"},As={key:0},Os=c(()=>e("div",{class:"px-3 py-2"},[e("button",{class:"btn orange-btn",type:"button","data-bs-toggle":"collapse","data-bs-target":"#bookReviewForm","aria-expanded":"false","aria-controls":"bookReviewForm"}," Add Review ")],-1)),js={class:"collapse",id:"bookReviewForm"},Es={class:"card mx-3"},Hs={class:"card-body"},qs={class:"row mb-3"},Gs={class:"col-3 d-flex align-items-center"},zs=["src","alt","title"],Js={class:"ms-2 fw-bold"},Ks=c(()=>e("div",{class:"col-5"},null,-1)),Ns={class:"col-4"},Qs=c(()=>e("div",{class:"my-0 ps-2 form-text"},"Recommendation",-1)),Ws={class:"d-flex align-items-center justify-content-around"},Xs={class:"me-2"},Ys=c(()=>e("option",{value:"Recommended"},"Recommend",-1)),Zs=c(()=>e("option",{value:"Mixed Feelings"},"Mixed Feelings",-1)),$s=c(()=>e("option",{value:"Not Recommended"},"Not Recommended",-1)),et=[Ys,Zs,$s],st=c(()=>e("div",{class:""},[e("button",{type:"submit",class:"py-0 px-2 btn btn-sm btn-success"},[e("i",{class:"mdi mdi-send-circle-outline fs-4"})])],-1)),tt={class:"row"},ot={class:"col-12"},it={key:1},at=c(()=>e("div",{class:"p-2"},"There are no reviews for this book.",-1)),nt=[at],ct={key:2,class:"pt-2"},lt={class:"mx-3 rounded dark-blue-bg"},dt={class:"p-3 text-light"},rt={class:"row mb-3"},ut={class:"col-3 d-flex align-items-center"},_t=["src","alt","title"],bt={class:"ms-2"},vt={class:"fw-bold"},kt={class:"text-secondary"},ht={class:"col-9 d-flex flex-column align-items-end"},gt={class:"d-flex align-items-center"},mt={key:0},ft={class:"d-flex align-items-center"},wt=c(()=>e("option",{value:"Recommended"},"Recommend",-1)),yt=c(()=>e("option",{value:"Mixed Feelings"},"Mixed Feelings",-1)),pt=c(()=>e("option",{value:"Not Recommended"},"Not Recommended",-1)),xt=[wt,yt,pt],Bt={class:""},Rt=c(()=>e("i",{class:"mdi mdi-close-outline fs-4"},null,-1)),Ct=[Rt],Dt=c(()=>e("i",{class:"mdi mdi-check-outline fs-4"},null,-1)),Pt=[Dt],It={key:1},Ut={key:0},Tt={class:"px-2 d-flex align-items-center justify-content-center text-light light-blue-bg rounded"},Lt=c(()=>e("i",{class:"mdi mdi-star fs-4"},null,-1)),St={class:"ms-1"},Mt={key:1},Ft={class:"px-2 d-flex align-items-center justify-content-center text-light bg-secondary rounded"},Vt=c(()=>e("i",{class:"mdi mdi-star-half-full fs-4"},null,-1)),At={class:"ms-1"},Ot={key:2},jt={class:"px-2 d-flex align-items-center justify-content-center text-dark bg-danger rounded"},Et=c(()=>e("i",{class:"mdi mdi-star-outline fs-4"},null,-1)),Ht={class:"ms-1"},qt={key:2},Gt={key:0,class:"d-flex"},zt={class:"mx-2"},Jt=["onClick"],Kt=c(()=>e("i",{class:"mdi mdi-pencil-outline fs-4"},null,-1)),Nt=[Kt],Qt={class:""},Wt=["onClick"],Xt=c(()=>e("i",{class:"mdi mdi-trash-can-outline fs-4"},null,-1)),Yt=[Xt],Zt={class:"row"},$t={class:"col-12"},eo={key:0,class:"px-2"},so={key:1,class:"px-2"},to=c(()=>e("div",{class:"fw-bold fs-5"},"Book Lists",-1)),oo=c(()=>e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),io={key:0},ao=["id","onUpdate:modelValue"],no=["for"],co={key:1},lo=["id","onUpdate:modelValue"],ro=["for"],uo=c(()=>e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1));function _o(f,t,k,s,m,B){const R=J("BookClubCard"),C=J("ModalBasic");return a(),n(x,null,[e("div",Te,[e("div",Le,[e("div",Se,[s.book?(a(),n("div",Me,[e("div",Fe,[e("img",{class:"img-fluid book-img",src:s.book.imgUrlLarge,alt:""},null,8,Ve)]),e("div",Ae,[e("div",Oe,[e("div",je,_(s.book.title),1),e("div",Ee,_(s.book.subtitle),1),e("div",He,[Re("By "),e("span",null,_(s.book.author),1)]),e("div",qe,[e("div",Ge,[ze,e("div",Je,_(s.bookScore),1),s.bookScoreUserCount==1?(a(),n("small",Ke,_(s.bookScoreUserCount)+" User",1)):(a(),n("small",Ne,_(s.bookScoreUserCount)+" Users",1))]),s.user.id?(a(),n("div",Qe,[e("div",We,[s.userHasThisBook?(a(),n("div",Xe,[Ye,p(e("select",{onChange:t[0]||(t[0]=o=>s.updateUserBookRating()),"onUpdate:modelValue":t[1]||(t[1]=o=>s.userBookData.rating=o),class:"fw-bold form-select form-select-sm ghost-bg border-0 rounded-start shadow-none selectable","aria-label":".form-select-sm rating"},[Ze,(a(!0),n(x,null,P(s.ratingOptions,o=>(a(),n("option",{key:o.rating,value:o.rating},_(o.rating)+" - "+_(o.description),9,$e))),128))],544),[[L,s.userBookData.rating]])])):w("",!0),s.userHasThisBook?(a(),n("div",es,[ss,p(e("select",{onChange:t[2]||(t[2]=o=>s.updateUserBookStatus()),"onUpdate:modelValue":t[3]||(t[3]=o=>s.userBookData.status=o),class:"fw-bold form-select form-select-sm ghost-bg border-0 rounded-start shadow-none selectable","aria-label":".form-select-sm status"},as,544),[[L,s.userBookData.status]])])):w("",!0),e("div",ns,[e("div",cs,[e("button",{onClick:t[4]||(t[4]=o=>s.openBookListsModal()),type:"button",class:"btn orange-btn"},ds)])])])])):w("",!0)]),e("div",rs,[us,e("small",{innerHTML:s.book.description,class:"pe-3"},null,8,_s)])])])])):w("",!0)])]),e("div",bs,[e("div",vs,[e("div",{class:S(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="reading","dark-blue-bg":s.selectedTab=="reading"}]),onClick:t[5]||(t[5]=o=>s.selectTab("reading"))},"Clubs Currently Reading",2)]),e("div",ks,[e("div",{class:S(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="planned","dark-blue-bg":s.selectedTab=="planned"}]),onClick:t[6]||(t[6]=o=>s.selectTab("planned"))},"Clubs Planning To Read",2)]),e("div",hs,[e("div",{class:S(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="finished","dark-blue-bg":s.selectedTab=="finished"}]),onClick:t[7]||(t[7]=o=>s.selectTab("finished"))},"Clubs Finished Reading",2)]),e("div",gs,[e("div",{class:S(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="reviews","dark-blue-bg":s.selectedTab=="reviews"}]),onClick:t[8]||(t[8]=o=>s.selectTab("reviews"))},"User Reviews",2)])]),e("div",ms,[e("div",fs,[e("div",ws,[s.selectedTab=="reading"?(a(),n("div",ys,[s.clubsReading.length?(a(),n("div",Rs,[(a(!0),n(x,null,P(s.clubsReading,o=>(a(),n("div",{key:o.id,class:"col-4"},[M(R,{clubProp:o},null,8,["clubProp"])]))),128))])):(a(),n("div",ps,Bs))])):s.selectedTab=="planned"?(a(),n("div",Cs,[s.clubsPlanned.length?(a(),n("div",Us,[(a(!0),n(x,null,P(s.clubsPlanned,o=>(a(),n("div",{key:o.id,class:"col-4"},[M(R,{clubProp:o},null,8,["clubProp"])]))),128))])):(a(),n("div",Ds,Is))])):s.selectedTab=="finished"?(a(),n("div",Ts,[s.clubsFinished.length?(a(),n("div",Fs,[(a(!0),n(x,null,P(s.clubsFinished,o=>(a(),n("div",{key:o.id,class:"col-4"},[M(R,{clubProp:o},null,8,["clubProp"])]))),128))])):(a(),n("div",Ls,Ms))])):s.selectedTab=="reviews"?(a(),n("div",Vs,[s.user.id&&s.userHasThisBook&&!s.userReviewedStatus?(a(),n("div",As,[Os,e("div",js,[e("div",Es,[e("div",Hs,[e("form",{onSubmit:t[11]||(t[11]=Ce(o=>s.createReview(),["prevent"]))},[e("div",qs,[e("div",Gs,[e("img",{class:"user-img",src:s.account.picture||s.user.picture,alt:s.user.name,title:s.user.name},null,8,zs),e("div",Js,_(s.user.name),1)]),Ks,e("div",Ns,[Qs,e("div",Ws,[e("div",Xs,[p(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>s.reviewData.rating=o),class:"form-select","aria-label":"Rating",required:""},et,512),[[L,s.reviewData.rating]])]),st])])]),e("div",tt,[e("div",ot,[p(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=o=>s.reviewData.content=o),class:"mb-2 pb-2 form-control",rows:"3",placeholder:"add review...",required:""},null,512),[[K,s.reviewData.content]])])])],32)])])])])):w("",!0),s.userReviews.length?(a(),n("div",ct,[(a(!0),n(x,null,P(s.userReviews,(o,u)=>(a(),n("div",{key:u,class:"col-12 pb-2"},[e("div",lt,[e("div",dt,[e("div",rt,[e("div",ut,[e("img",{class:"user-img",src:o.creator.picture,alt:o.creator.name,title:o.creator.name},null,8,_t),e("div",bt,[e("div",vt,_(o.creator.name),1),e("small",kt,"Posted "+_(o.createdAt.toLocaleDateString("en-us",{year:"numeric",month:"short",day:"numeric"})),1)])]),e("div",ht,[e("div",gt,[s.reviewEditMode?(a(),n("div",mt,[e("div",ft,[e("div",null,[p(e("select",{"onUpdate:modelValue":t[12]||(t[12]=b=>s.reviewData.rating=b),class:"form-select form-control input-sm","aria-label":"Rating",required:""},xt,512),[[L,s.reviewData.rating]])]),e("div",Bt,[e("button",{class:"mx-2 btn btn-sm btn-secondary py-0 px-2",onClick:t[13]||(t[13]=b=>s.reviewEditMode=!1),title:"Cancel Changes"},Ct),e("button",{class:"btn btn-sm btn-success py-0 px-2",onClick:t[14]||(t[14]=b=>s.updateReview()),title:"Save Changes"},Pt)])])])):(a(),n("div",It,[o.rating=="Recommended"?(a(),n("div",Ut,[e("div",Tt,[Lt,e("div",St,_(o.rating),1)])])):o.rating=="Mixed Feelings"?(a(),n("div",Mt,[e("div",Ft,[Vt,e("div",At,_(o.rating),1)])])):o.rating=="Not Recommended"?(a(),n("div",Ot,[e("div",jt,[Et,e("div",Ht,_(o.rating),1)])])):w("",!0)])),s.reviewEditMode?w("",!0):(a(),n("div",qt,[s.user.id==o.creatorId?(a(),n("div",Gt,[e("div",zt,[e("button",{class:"btn btn-sm btn-secondary py-0 px-2",onClick:b=>s.editReview(o),title:"Edit Review"},Nt,8,Jt)]),e("div",Qt,[e("button",{class:"btn btn-sm btn-danger py-0 px-2",onClick:b=>s.deleteReview(o),title:"Delete Review"},Yt,8,Wt)])])):w("",!0)]))])])]),e("div",Zt,[e("div",$t,[s.reviewEditMode?(a(),n("div",eo,[p(e("textarea",{"onUpdate:modelValue":t[15]||(t[15]=b=>s.reviewData.content=b),class:"mb-2 pb-2 form-control",rows:"3",required:""},null,512),[[K,s.reviewData.content]])])):(a(),n("div",so,_(o.content),1))])])])])]))),128))])):(a(),n("div",it,nt))])):w("",!0)])])])]),M(C,{id:"bookLists"},{header:V(()=>[to,oo]),body:V(()=>[(a(!0),n(x,null,P(s.bookListsOptions,(o,u,b)=>(a(),n("div",{key:b,class:"form-check"},[s.bookListsOptions[u].existsInBookList?(a(),n("div",io,[p(e("input",{id:u,"onUpdate:modelValue":h=>s.bookListsOptions[u].selected=h,type:"checkbox",class:"form-check-input",checked:""},null,8,ao),[[W,s.bookListsOptions[u].selected]]),e("label",{for:u,class:"form-check-label"},_(u)+" Books",9,no)])):(a(),n("div",co,[p(e("input",{id:u,"onUpdate:modelValue":h=>s.bookListsOptions[u].selected=h,type:"checkbox",class:"form-check-input"},null,8,lo),[[W,s.bookListsOptions[u].selected]]),e("label",{for:u,class:"form-check-label"},_(u)+" Books",9,ro)]))]))),128))]),footer:V(()=>[uo,e("button",{onClick:t[16]||(t[16]=o=>s.updateBookLists()),type:"button",class:"btn btn-primary"},"Submit")]),_:1})],64)}const vo=we(Ue,[["render",_o],["__scopeId","data-v-60bcfc2c"]]);export{vo as default};
