import{y as L,k as r,_ as ye,B as pe,M as xe,u as Be,f as R,g as v,z as J,D as Re,r as K,o as a,c as n,a as e,t as u,j as De,E as x,G as S,F as D,h as C,i as w,x as M,H as Ce,I as N,b as F,w as A,J as h,P as d,K as Q,v as W,L as X,p as Pe,e as Ie}from"./index-f9aec92b.js";class O{constructor(t){this.id=t.id,this.gbId=t.gbId,this.creatorId=t.creatorId,this.content=t.content,this.rating=t.rating,this.creator=t.creator,this.createdAt=new Date(t.createdAt),this.updatedAt=new Date(t.updatedAt)}}class Ue{async setBookDetailsPageReviews(t){const s=(await L.get(`api/bookReviews?gbId=${t}`)).data;r.bookDetailsPage.userReviews=s.map(g=>new O(g))}async createBookReview(t){const k=await L.post("api/bookReviews",t),s=new O(k.data);return r.bookDetailsPage.userReviews.unshift(s),s}async updateBookReview(t){const k=await L.put(`api/bookReviews/${t.id}`,t),s=new O(k.data),g=r.bookDetailsPage.userReviews.find(P=>P.id==s.id);r.bookDetailsPage.userReviews.splice(g,1,s)}async deleteBookReview(t){await L.delete(`api/bookReviews/${t}`);const k=r.bookDetailsPage.userReviews.findIndex(s=>s.id==t);r.bookDetailsPage.userReviews.splice(k,1)}}const V=new Ue;const Te={components:{BookClubCard:pe,ModalBasic:xe},setup(){const f=Be();let t=f.params.gbId;const k=R({rating:0,status:"planned"}),s=R("reviews"),g=R({gbId:t,rating:null,content:null}),P=R({}),B=R(!1),I=R(!0),o=R({}),_=v(()=>r.account),b=v(()=>r.user),m=v(()=>r.bookDetailsPage.book),y=v(()=>r.bookDetailsPage.userBook),U=v(()=>!!r.bookDetailsPage.userBook),Y=v(()=>r.bookDetailsPage.userCreatorAdminClubs),j=v(()=>r.bookDetailsPage.userReviews),Z=v(()=>r.bookDetailsPage.clubs.planned),$=v(()=>r.bookDetailsPage.clubs.reading),ee=v(()=>r.bookDetailsPage.clubs.finished),se=v(()=>Number(r.bookDetailsPage.bookScore).toFixed(2)),te=v(()=>r.bookDetailsPage.bookScoreUserCount),oe=v(()=>r.bookDetailsPage.userBook?r.bookDetailsPage.userBook.rating:0),ie=v(()=>r.bookDetailsPage.userBook?r.bookDetailsPage.userBook.status:"planned"),ae=[{rating:1,description:"Horrendous"},{rating:2,description:"Terrible"},{rating:3,description:"Bad"},{rating:4,description:"Meh"},{rating:5,description:"Average"},{rating:6,description:"Good"},{rating:7,description:"Very Good"},{rating:8,description:"Great"},{rating:9,description:"Outstanding"},{rating:10,description:"Masterpiece"}];async function ne(){try{await h.setBookDetailsPageBook(t),await E(),await H()}catch(i){d.error(i.message)}}async function E(){try{await h.setBookScore(t)}catch(i){d.error(i.message)}}async function H(){try{await V.setBookDetailsPageReviews(t),T()}catch(i){d.error(i.message)}}async function ce(){await q(),await G(),await le(),T()}async function q(){try{await h.setBookDetailsPageUserBooks(),await G()}catch(i){d.error(i.message)}}async function G(){try{h.setBookDetailsPageUserBook(t),k.value.rating=y.value?y.value.rating:"null",k.value.status=y.value?y.value.status:"null"}catch(i){d.error(i.message)}}async function le(){try{await W.setBookDetailsPageUserClubs(b.value.id)}catch(i){d.error(i.message)}}function T(){if("id"in b.value)try{const i=j.value.filter(l=>l.gbId==t&&l.creatorId==b.value.id);I.value=!!i.length}catch(i){d.error(i.message)}}async function de(){try{await h.updateUserBook(y.value.id,{rating:k.value.rating}),E(),d.toast("Rating updated successfully","success")}catch(i){d.error(i.message)}}async function re(){try{await h.updateUserBook(y.value.id,{status:k.value.status}),d.toast("Progress updated successfully","success")}catch(i){d.error(i.message)}}async function ue(){o.value.My={bookListType:"user",bookId:U.value?y.value.id:"",existsInBookList:U.value,selected:U.value},Y.value.forEach(async i=>{const l=await _e(i);o.value[i.name]={bookListType:"club",bookId:l?l.id:"",clubId:i.id,existsInBookList:!!l,selected:!!l}}),Q.getOrCreateInstance("#bookLists").show()}async function _e(i){const l=await h.getBooksByClubId(i.id);if(!l)return null;const p=l.find(we=>we.gbId==t);return p||null}async function be(){for(const[i,l]of Object.entries(o.value))try{switch(l.bookListType){case"user":l.selected&&!l.existsInBookList?(await h.createUserBook(m.value),d.toast(`Added to ${i} Books successfully`,"success")):!l.selected&&l.existsInBookList&&(await d.confirm(`Are you sure you want to remove this book from ${i} Books?`)?(await h.deleteUserBook(l.bookId),d.toast(`Removed from ${i} Books successfully`,"success")):l.selected=!0),await q();break;case"club":if(l.selected&&!l.existsInBookList){const p={clubId:l.clubId,gbId:m.value.gbId,title:m.value.title,imgUrl:m.value.imgUrl,author:m.value.author,rating:0,status:"planned"};await h.createClubBook(p),d.toast(`Added to ${i} Books successfully`,"success")}else!l.selected&&l.existsInBookList&&(await d.confirm(`Are you sure you want to remove this book from ${i} Books?`)?(await h.deleteClubBook(l.bookId),d.toast(`Removed from ${i} Books successfully`,"success")):l.selected=!0);break}}catch(p){d.error(p.message)}Q.getOrCreateInstance("#bookLists").hide()}async function ve(){try{const i=await V.createBookReview(g.value);g.value=i,T()}catch(i){d.error(i.message)}}function ke(i){P.value=g.value,g.value=i,B.value=!0}async function he(){try{await V.updateBookReview(g.value),B.value=!1,d.toast("Book Review updated successfully","success")}catch(i){d.error(i.message)}}async function ge(i){try{if(!await d.confirm("Are you sure you want to delete this review?"))return;await V.deleteBookReview(i.id),T()}catch(l){d.error(l.message)}}async function z(i){s.value=i,s.value=="reviews"?await H():await me(i)}async function me(i){try{await W.setBookDetailsPageClubs(t,i)}catch(l){d.error(l.message)}}function fe(){try{h.clearBooks()}catch(i){d.error(i.message)}}return J(async()=>{b.value.id&&await ce()}),J(async()=>{t=f.params.gbId,await ne(),await z("reviews")}),Re(()=>{fe()}),{book:m,account:_,user:b,userBook:y,userBookRating:oe,userBookStatus:ie,userHasThisBook:U,bookScore:se,bookScoreUserCount:te,userBookData:k,userReviews:j,userReviewedStatus:I,clubsPlanned:Z,clubsReading:$,clubsFinished:ee,selectedTab:s,reviewData:g,bookListsOptions:o,reviewEditMode:B,ratingOptions:ae,updateUserBookRating:de,updateUserBookStatus:re,openBookListsModal:ue,updateBookLists:be,createReview:ve,editReview:ke,updateReview:he,deleteReview:ge,selectTab:z}}},c=f=>(Pe("data-v-7f6bc6e3"),f=f(),Ie(),f),Le={class:"container-fluid"},Se={class:"row"},Me={class:"col-12"},Fe={key:0,class:"row mt-4"},Ve={class:"col-5 d-flex justify-content-center"},Ae=["src"],Oe={class:"col-7 h-100"},je={class:"d-flex flex-column h-100"},Ee={class:"fs-2 fw-bold"},He={class:"fs-5 fw-bold"},qe={class:"fs-5"},Ge={class:"mt-2 d-flex justify-content-between"},ze={class:"text-center me-1 mb-2"},Je=c(()=>e("div",{class:"text-light light-blue-bg rounded px-2"},"Score",-1)),Ke={class:"fw-bold"},Ne={key:0,class:"text-muted"},Qe={key:1,class:"fw-bold text-muted"},We={key:0},Xe={class:"d-flex justify-content-around"},Ye={key:0,class:"text-center pe-2"},Ze=c(()=>e("div",{class:"text-light light-blue-bg rounded px-2"},"My Rating",-1)),$e=c(()=>e("option",{value:"0"},"Not Rated",-1)),es=["value"],ss={key:1,class:"text-center pe-2"},ts=c(()=>e("div",{class:"text-light light-blue-bg rounded px-2"},"Progress",-1)),os=c(()=>e("option",{value:"planned"},"Plan To Read",-1)),is=c(()=>e("option",{value:"reading"},"Currently Reading",-1)),as=c(()=>e("option",{value:"finished"},"Finished",-1)),ns=[os,is,as],cs={class:"d-flex justify-content-around"},ls={class:"me-2"},ds=c(()=>e("div",{class:"d-flex align-items-center"},[e("i",{class:"mdi mdi-list-status fs-5 pe-2"}),e("div",null,"Lists")],-1)),rs=[ds],us={class:"description-section"},_s=c(()=>e("div",{class:"mt-2 fs-5 fw-bold"},"Description",-1)),bs=["innerHTML"],vs={class:"row mt-3 g-1"},ks={class:"col-3 text-center selectable"},hs={class:"col-3 text-center selectable"},gs={class:"col-4 text-center selectable"},ms={class:"col-2 text-center selectable"},fs={class:"row"},ws={class:"col-12"},ys={class:"dark-blue-bg p-2"},ps={key:0,class:"bg-dark"},xs={key:0},Bs=c(()=>e("div",{class:"p-2"},"There are no clubs currently reading this book.",-1)),Rs=[Bs],Ds={key:1,class:"row py-2"},Cs={key:1,class:"bg-dark"},Ps={key:0},Is=c(()=>e("div",{class:"p-2"},"There are no clubs planning to read this book.",-1)),Us=[Is],Ts={key:1,class:"row py-2"},Ls={key:2,class:"bg-dark"},Ss={key:0},Ms=c(()=>e("div",{class:"p-2"},"There are no clubs finished reading this book.",-1)),Fs=[Ms],Vs={key:1,class:"row py-2"},As={key:3,class:"bg-dark"},Os={key:0},js=c(()=>e("div",{class:"px-3 py-2"},[e("button",{class:"btn orange-btn",type:"button","data-bs-toggle":"collapse","data-bs-target":"#bookReviewForm","aria-expanded":"false","aria-controls":"bookReviewForm"}," Add Review ")],-1)),Es={class:"collapse",id:"bookReviewForm"},Hs={class:"card mx-3"},qs={class:"card-body"},Gs={class:"row mb-3"},zs={class:"col-3 d-flex align-items-center"},Js=["src","alt","title"],Ks={class:"ms-2 fw-bold"},Ns=c(()=>e("div",{class:"col-5"},null,-1)),Qs={class:"col-4"},Ws=c(()=>e("div",{class:"my-0 ps-2 form-text"},"Recommendation",-1)),Xs={class:"d-flex align-items-center justify-content-around"},Ys={class:"me-2"},Zs=c(()=>e("option",{value:"Recommended"},"Recommend",-1)),$s=c(()=>e("option",{value:"Mixed Feelings"},"Mixed Feelings",-1)),et=c(()=>e("option",{value:"Not Recommended"},"Not Recommended",-1)),st=[Zs,$s,et],tt=c(()=>e("div",{class:""},[e("button",{type:"submit",class:"py-0 px-2 btn btn-sm btn-success"},[e("i",{class:"mdi mdi-send-circle-outline fs-4"})])],-1)),ot={class:"row"},it={class:"col-12"},at={key:1},nt=c(()=>e("div",{class:"p-2"},"There are no reviews for this book.",-1)),ct=[nt],lt={key:2,class:"pt-2"},dt={class:"mx-3 rounded dark-blue-bg"},rt={class:"p-3 text-light"},ut={class:"row mb-3"},_t={class:"col-3 d-flex align-items-center"},bt=["src","alt","title"],vt={class:"ms-2"},kt={class:"fw-bold"},ht={class:"text-secondary"},gt={class:"col-9 d-flex flex-column align-items-end"},mt={class:"d-flex align-items-center"},ft={key:0},wt={class:"d-flex align-items-center"},yt=c(()=>e("option",{value:"Recommended"},"Recommend",-1)),pt=c(()=>e("option",{value:"Mixed Feelings"},"Mixed Feelings",-1)),xt=c(()=>e("option",{value:"Not Recommended"},"Not Recommended",-1)),Bt=[yt,pt,xt],Rt={class:""},Dt=c(()=>e("i",{class:"mdi mdi-close-outline fs-4"},null,-1)),Ct=[Dt],Pt=c(()=>e("i",{class:"mdi mdi-check-outline fs-4"},null,-1)),It=[Pt],Ut={key:1},Tt={key:0},Lt={class:"px-2 d-flex align-items-center justify-content-center text-light light-blue-bg rounded"},St=c(()=>e("i",{class:"mdi mdi-star fs-4"},null,-1)),Mt={class:"ms-1"},Ft={key:1},Vt={class:"px-2 d-flex align-items-center justify-content-center text-light bg-secondary rounded"},At=c(()=>e("i",{class:"mdi mdi-star-half-full fs-4"},null,-1)),Ot={class:"ms-1"},jt={key:2},Et={class:"px-2 d-flex align-items-center justify-content-center text-dark bg-danger rounded"},Ht=c(()=>e("i",{class:"mdi mdi-star-outline fs-4"},null,-1)),qt={class:"ms-1"},Gt={key:2},zt={key:0,class:"d-flex"},Jt={class:"mx-2"},Kt=["onClick"],Nt=c(()=>e("i",{class:"mdi mdi-pencil-outline fs-4"},null,-1)),Qt=[Nt],Wt={class:""},Xt=["onClick"],Yt=c(()=>e("i",{class:"mdi mdi-trash-can-outline fs-4"},null,-1)),Zt=[Yt],$t={class:"row"},eo={class:"col-12"},so={key:0,class:"px-2"},to={key:1,class:"px-2"},oo=c(()=>e("div",{class:"fw-bold fs-5"},"Book Lists",-1)),io=c(()=>e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),ao={key:0},no=["id","onUpdate:modelValue"],co=["for"],lo={key:1},ro=["id","onUpdate:modelValue"],uo=["for"],_o=c(()=>e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1));function bo(f,t,k,s,g,P){const B=K("BookClubCard"),I=K("ModalBasic");return a(),n(D,null,[e("div",Le,[e("div",Se,[e("div",Me,[s.book?(a(),n("div",Fe,[e("div",Ve,[e("img",{class:"img-fluid book-img",src:s.book.imgUrlLarge,alt:""},null,8,Ae)]),e("div",Oe,[e("div",je,[e("div",Ee,u(s.book.title),1),e("div",He,u(s.book.subtitle),1),e("div",qe,[De("By "),e("span",null,u(s.book.author),1)]),e("div",Ge,[e("div",ze,[Je,e("div",Ke,u(s.bookScore),1),s.bookScoreUserCount==1?(a(),n("small",Ne,u(s.bookScoreUserCount)+" User",1)):(a(),n("small",Qe,u(s.bookScoreUserCount)+" Users",1))]),s.user.id?(a(),n("div",We,[e("div",Xe,[s.userHasThisBook?(a(),n("div",Ye,[Ze,x(e("select",{onChange:t[0]||(t[0]=o=>s.updateUserBookRating()),"onUpdate:modelValue":t[1]||(t[1]=o=>s.userBookData.rating=o),class:"fw-bold form-select form-select-sm ghost-bg border-0 rounded-start shadow-none selectable","aria-label":".form-select-sm rating"},[$e,(a(!0),n(D,null,C(s.ratingOptions,o=>(a(),n("option",{key:o.rating,value:o.rating},u(o.rating)+" - "+u(o.description),9,es))),128))],544),[[S,s.userBookData.rating]])])):w("",!0),s.userHasThisBook?(a(),n("div",ss,[ts,x(e("select",{onChange:t[2]||(t[2]=o=>s.updateUserBookStatus()),"onUpdate:modelValue":t[3]||(t[3]=o=>s.userBookData.status=o),class:"fw-bold form-select form-select-sm ghost-bg border-0 rounded-start shadow-none selectable","aria-label":".form-select-sm status"},ns,544),[[S,s.userBookData.status]])])):w("",!0),e("div",cs,[e("div",ls,[e("button",{onClick:t[4]||(t[4]=o=>s.openBookListsModal()),type:"button",class:"btn orange-btn"},rs)])])])])):w("",!0)]),e("div",us,[_s,e("small",{innerHTML:s.book.description,class:"pe-3"},null,8,bs)])])])])):w("",!0)])]),e("div",vs,[e("div",ks,[e("div",{class:M(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="reading","dark-blue-bg":s.selectedTab=="reading"}]),onClick:t[5]||(t[5]=o=>s.selectTab("reading"))},"Clubs Currently Reading",2)]),e("div",hs,[e("div",{class:M(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="planned","dark-blue-bg":s.selectedTab=="planned"}]),onClick:t[6]||(t[6]=o=>s.selectTab("planned"))},"Clubs Planning To Read",2)]),e("div",gs,[e("div",{class:M(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="finished","dark-blue-bg":s.selectedTab=="finished"}]),onClick:t[7]||(t[7]=o=>s.selectTab("finished"))},"Clubs Finished Reading",2)]),e("div",ms,[e("div",{class:M(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="reviews","dark-blue-bg":s.selectedTab=="reviews"}]),onClick:t[8]||(t[8]=o=>s.selectTab("reviews"))},"User Reviews",2)])]),e("div",fs,[e("div",ws,[e("div",ys,[s.selectedTab=="reading"?(a(),n("div",ps,[s.clubsReading.length?(a(),n("div",Ds,[(a(!0),n(D,null,C(s.clubsReading,o=>(a(),n("div",{key:o.id,class:"col-4"},[F(B,{clubProp:o},null,8,["clubProp"])]))),128))])):(a(),n("div",xs,Rs))])):s.selectedTab=="planned"?(a(),n("div",Cs,[s.clubsPlanned.length?(a(),n("div",Ts,[(a(!0),n(D,null,C(s.clubsPlanned,o=>(a(),n("div",{key:o.id,class:"col-4"},[F(B,{clubProp:o},null,8,["clubProp"])]))),128))])):(a(),n("div",Ps,Us))])):s.selectedTab=="finished"?(a(),n("div",Ls,[s.clubsFinished.length?(a(),n("div",Vs,[(a(!0),n(D,null,C(s.clubsFinished,o=>(a(),n("div",{key:o.id,class:"col-4"},[F(B,{clubProp:o},null,8,["clubProp"])]))),128))])):(a(),n("div",Ss,Fs))])):s.selectedTab=="reviews"?(a(),n("div",As,[s.user.id&&s.userHasThisBook&&!s.userReviewedStatus?(a(),n("div",Os,[js,e("div",Es,[e("div",Hs,[e("div",qs,[e("form",{onSubmit:t[11]||(t[11]=Ce(o=>s.createReview(),["prevent"]))},[e("div",Gs,[e("div",zs,[e("img",{class:"user-img",src:s.account.picture||s.user.picture,alt:s.user.name,title:s.user.name},null,8,Js),e("div",Ks,u(s.user.name),1)]),Ns,e("div",Qs,[Ws,e("div",Xs,[e("div",Ys,[x(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>s.reviewData.rating=o),class:"form-select","aria-label":"Rating",required:""},st,512),[[S,s.reviewData.rating]])]),tt])])]),e("div",ot,[e("div",it,[x(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=o=>s.reviewData.content=o),class:"mb-2 pb-2 form-control",rows:"3",placeholder:"add review...",required:""},null,512),[[N,s.reviewData.content]])])])],32)])])])])):w("",!0),s.userReviews.length?(a(),n("div",lt,[(a(!0),n(D,null,C(s.userReviews,(o,_)=>(a(),n("div",{key:_,class:"col-12 pb-2"},[e("div",dt,[e("div",rt,[e("div",ut,[e("div",_t,[e("img",{class:"user-img",src:o.creator.picture,alt:o.creator.name,title:o.creator.name},null,8,bt),e("div",vt,[e("div",kt,u(o.creator.name),1),e("small",ht,"Posted "+u(o.createdAt.toLocaleDateString("en-us",{year:"numeric",month:"short",day:"numeric"})),1)])]),e("div",gt,[e("div",mt,[s.reviewEditMode?(a(),n("div",ft,[e("div",wt,[e("div",null,[x(e("select",{"onUpdate:modelValue":t[12]||(t[12]=b=>s.reviewData.rating=b),class:"form-select form-control input-sm","aria-label":"Rating",required:""},Bt,512),[[S,s.reviewData.rating]])]),e("div",Rt,[e("button",{class:"mx-2 btn btn-sm btn-secondary py-0 px-2",onClick:t[13]||(t[13]=b=>s.reviewEditMode=!1),title:"Cancel Changes"},Ct),e("button",{class:"btn btn-sm btn-success py-0 px-2",onClick:t[14]||(t[14]=b=>s.updateReview()),title:"Save Changes"},It)])])])):(a(),n("div",Ut,[o.rating=="Recommended"?(a(),n("div",Tt,[e("div",Lt,[St,e("div",Mt,u(o.rating),1)])])):o.rating=="Mixed Feelings"?(a(),n("div",Ft,[e("div",Vt,[At,e("div",Ot,u(o.rating),1)])])):o.rating=="Not Recommended"?(a(),n("div",jt,[e("div",Et,[Ht,e("div",qt,u(o.rating),1)])])):w("",!0)])),s.reviewEditMode?w("",!0):(a(),n("div",Gt,[s.user.id==o.creatorId?(a(),n("div",zt,[e("div",Jt,[e("button",{class:"btn btn-sm btn-secondary py-0 px-2",onClick:b=>s.editReview(o),title:"Edit Review"},Qt,8,Kt)]),e("div",Wt,[e("button",{class:"btn btn-sm btn-danger py-0 px-2",onClick:b=>s.deleteReview(o),title:"Delete Review"},Zt,8,Xt)])])):w("",!0)]))])])]),e("div",$t,[e("div",eo,[s.reviewEditMode?(a(),n("div",so,[x(e("textarea",{"onUpdate:modelValue":t[15]||(t[15]=b=>s.reviewData.content=b),class:"mb-2 pb-2 form-control",rows:"3",required:""},null,512),[[N,s.reviewData.content]])])):(a(),n("div",to,u(o.content),1))])])])])]))),128))])):(a(),n("div",at,ct))])):w("",!0)])])])]),F(I,{id:"bookLists"},{header:A(()=>[oo,io]),body:A(()=>[(a(!0),n(D,null,C(s.bookListsOptions,(o,_,b)=>(a(),n("div",{key:b,class:"form-check"},[s.bookListsOptions[_].existsInBookList?(a(),n("div",ao,[x(e("input",{id:_,"onUpdate:modelValue":m=>s.bookListsOptions[_].selected=m,type:"checkbox",class:"form-check-input",checked:""},null,8,no),[[X,s.bookListsOptions[_].selected]]),e("label",{for:_,class:"form-check-label"},u(_)+" Books",9,co)])):(a(),n("div",lo,[x(e("input",{id:_,"onUpdate:modelValue":m=>s.bookListsOptions[_].selected=m,type:"checkbox",class:"form-check-input"},null,8,ro),[[X,s.bookListsOptions[_].selected]]),e("label",{for:_,class:"form-check-label"},u(_)+" Books",9,uo)]))]))),128))]),footer:A(()=>[_o,e("button",{onClick:t[16]||(t[16]=o=>s.updateBookLists()),type:"button",class:"btn btn-primary"},"Submit")]),_:1})],64)}const ko=ye(Te,[["render",bo],["__scopeId","data-v-7f6bc6e3"]]);export{ko as default};
