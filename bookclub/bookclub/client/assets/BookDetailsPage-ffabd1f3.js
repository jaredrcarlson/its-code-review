import{z as T,k as r,_ as ye,B as pe,M as xe,u as Be,f as D,g as v,D as z,E as Re,r as N,o as a,c as n,a as e,t as _,j as Ce,G as p,H as L,F as B,h as P,i as w,y as S,I as De,J,b as M,w as V,K as g,P as l,L as K,x as Q,N as W,p as Pe,e as Ie}from"./index-1e2f9b09.js";class A{constructor(t){this.id=t.id,this.gbId=t.gbId,this.creatorId=t.creatorId,this.content=t.content,this.rating=t.rating,this.creator=t.creator,this.createdAt=new Date(t.createdAt),this.updatedAt=new Date(t.updatedAt)}}class Ue{async setBookDetailsPageReviews(t){const s=(await T.get(`api/bookReviews?gbId=${t}`)).data;r.bookDetailsPage.userReviews=s.map(m=>new A(m))}async createBookReview(t){const k=await T.post("api/bookReviews",t),s=new A(k.data);return r.bookDetailsPage.userReviews.unshift(s),s}async updateBookReview(t){const k=await T.put(`api/bookReviews/${t.id}`,t),s=new A(k.data),m=r.bookDetailsPage.userReviews.find(x=>x.id==s.id);r.bookDetailsPage.userReviews.splice(m,1,s)}async deleteBookReview(t){await T.delete(`api/bookReviews/${t}`);const k=r.bookDetailsPage.userReviews.findIndex(s=>s.id==t);r.bookDetailsPage.userReviews.splice(k,1)}}const F=new Ue;const Te={components:{BookClubCard:pe,ModalBasic:xe},setup(){const f=Be();let t=f.params.gbId;const k=D({rating:0,status:"planned"}),s=D("reviews"),m=D({gbId:t}),x=D(!1),R=D(!0),C=D({}),o=v(()=>r.account),u=v(()=>r.user),b=v(()=>r.bookDetailsPage.book),h=v(()=>r.bookDetailsPage.userBook),I=v(()=>!!r.bookDetailsPage.userBook),X=v(()=>r.bookDetailsPage.userCreatorAdminClubs),O=v(()=>r.bookDetailsPage.userReviews),Y=v(()=>r.bookDetailsPage.clubs.planned),Z=v(()=>r.bookDetailsPage.clubs.reading),$=v(()=>r.bookDetailsPage.clubs.finished),ee=v(()=>Number(r.bookDetailsPage.bookScore).toFixed(2)),se=v(()=>r.bookDetailsPage.bookScoreUserCount),te=v(()=>r.bookDetailsPage.userBook?r.bookDetailsPage.userBook.rating:0),oe=v(()=>r.bookDetailsPage.userBook?r.bookDetailsPage.userBook.status:"planned"),ie=[{rating:1,description:"Horrendous"},{rating:2,description:"Terrible"},{rating:3,description:"Bad"},{rating:4,description:"Meh"},{rating:5,description:"Average"},{rating:6,description:"Good"},{rating:7,description:"Very Good"},{rating:8,description:"Great"},{rating:9,description:"Outstanding"},{rating:10,description:"Masterpiece"}];async function ae(){try{await g.setBookDetailsPageBook(t),await E(),await j()}catch(i){l.error(i.message)}}async function E(){try{await g.setBookScore(t)}catch(i){l.error(i.message)}}async function j(){try{await F.setBookDetailsPageReviews(t),U()}catch(i){l.error(i.message)}}async function ne(){await H(),await q(),await ce(),U()}async function H(){try{await g.setBookDetailsPageUserBooks(),await q()}catch(i){l.error(i.message)}}async function q(){try{g.setBookDetailsPageUserBook(t),k.value.rating=h.value?h.value.rating:"null",k.value.status=h.value?h.value.status:"null"}catch(i){l.error(i.message)}}async function ce(){try{await Q.setBookDetailsPageUserClubs(u.value.id)}catch(i){l.error(i.message)}}function U(){if("id"in u.value)try{const i=O.value.filter(d=>d.gbId==t&&d.creatorId==u.value.id);R.value=!!i.length}catch(i){l.error(i.message)}}async function de(){try{await g.updateUserBook(h.value.id,{rating:k.value.rating}),E(),l.toast("Rating updated successfully","success")}catch(i){l.error(i.message)}}async function le(){try{await g.updateUserBook(h.value.id,{status:k.value.status}),l.toast("Progress updated successfully","success")}catch(i){l.error(i.message)}}async function re(){C.value.My={bookListType:"user",bookId:I.value?h.value.id:"",existsInBookList:I.value,selected:I.value},X.value.forEach(async i=>{const d=await ue(i);C.value[i.name]={bookListType:"club",bookId:d?d.id:"",clubId:i.id,existsInBookList:!!d,selected:!!d}}),K.getOrCreateInstance("#bookLists").show()}async function ue(i){const d=await g.getBooksByClubId(i.id);if(!d)return null;const y=d.find(we=>we.gbId==t);return y||null}async function _e(){for(const[i,d]of Object.entries(C.value))try{switch(d.bookListType){case"user":d.selected&&!d.existsInBookList?(await g.createUserBook(b.value),l.toast(`Added to ${i} Books successfully`,"success")):!d.selected&&d.existsInBookList&&(await l.confirm(`Are you sure you want to remove this book from ${i} Books?`)?(await g.deleteUserBook(d.bookId),l.toast(`Removed from ${i} Books successfully`,"success")):d.selected=!0),await H();break;case"club":if(d.selected&&!d.existsInBookList){const y={clubId:d.clubId,gbId:b.value.gbId,title:b.value.title,imgUrl:b.value.imgUrl,author:b.value.author,rating:0,status:"planned"};await g.createClubBook(y),l.toast(`Added to ${i} Books successfully`,"success")}else!d.selected&&d.existsInBookList&&(await l.confirm(`Are you sure you want to remove this book from ${i} Books?`)?(await g.deleteClubBook(d.bookId),l.toast(`Removed from ${i} Books successfully`,"success")):d.selected=!0);break}}catch(y){l.error(y.message)}K.getOrCreateInstance("#bookLists").hide()}async function be(){try{const i=await F.createBookReview(m.value);m.value=i,U()}catch(i){l.error(i.message)}}function ve(i){m.value={...i},x.value=!0}function ke(){x.value=!1}async function he(){try{await F.updateBookReview(m.value),x.value=!1,l.toast("Book Review updated successfully","success")}catch(i){l.error(i.message)}}async function ge(i){try{if(!await l.confirm("Are you sure you want to delete this review?"))return;await F.deleteBookReview(i.id),U()}catch(d){l.error(d.message)}}async function G(i){s.value=i,s.value=="reviews"?await j():await me(i)}async function me(i){try{await Q.setBookDetailsPageClubs(t,i)}catch(d){l.error(d.message)}}function fe(){try{g.clearBooks()}catch(i){l.error(i.message)}}return z(async()=>{u.value.id&&await ne()}),z(async()=>{t=f.params.gbId,await ae(),await G("reviews")}),Re(()=>{fe()}),{book:b,account:o,user:u,userBook:h,userBookRating:te,userBookStatus:oe,userHasThisBook:I,bookScore:ee,bookScoreUserCount:se,userBookData:k,userReviews:O,userReviewedStatus:R,clubsPlanned:Y,clubsReading:Z,clubsFinished:$,selectedTab:s,userReviewData:m,bookListsOptions:C,reviewEditMode:x,ratingOptions:ie,updateUserBookRating:de,updateUserBookStatus:le,openBookListsModal:re,updateBookLists:_e,createReview:be,editReview:ve,cancelEditReview:ke,updateReview:he,deleteReview:ge,selectTab:G}}},c=f=>(Pe("data-v-8e93a643"),f=f(),Ie(),f),Le={class:"container-fluid"},Se={class:"row"},Me={class:"col-12"},Fe={key:0,class:"row mt-4"},Ve={class:"col-12 col-md-5 d-flex justify-content-center"},Ae=["src"],Oe={class:"col-7 h-100"},Ee={class:"d-flex flex-column h-100"},je={class:"fs-2 fw-bold"},He={class:"fs-5 fw-bold"},qe={class:"fs-5"},Ge={class:"mt-2 d-flex justify-content-between"},ze={class:"text-center me-1 mb-2"},Ne=c(()=>e("div",{class:"text-light light-blue-bg rounded px-2"},"Score",-1)),Je={class:"fw-bold"},Ke={key:0,class:"text-muted"},Qe={key:1,class:"fw-bold text-muted"},We={key:0},Xe={class:"d-flex justify-content-around"},Ye={key:0,class:"text-center pe-2"},Ze=c(()=>e("div",{class:"text-light light-blue-bg rounded px-2"},"Rating",-1)),$e=c(()=>e("option",{value:"0"},"Not Rated",-1)),es=["value"],ss={key:1,class:"text-center pe-2"},ts=c(()=>e("div",{class:"text-light light-blue-bg rounded px-2"},"Progress",-1)),os=c(()=>e("option",{value:"planned"},"Plan To Read",-1)),is=c(()=>e("option",{value:"reading"},"Currently Reading",-1)),as=c(()=>e("option",{value:"finished"},"Finished",-1)),ns=[os,is,as],cs={class:"d-flex justify-content-around"},ds={class:"me-2"},ls=c(()=>e("div",{class:"d-flex align-items-center"},[e("i",{class:"mdi mdi-list-status fs-5 pe-2"}),e("div",null,"Lists")],-1)),rs=[ls],us={class:"description-section"},_s=c(()=>e("div",{class:"mt-2 fs-5 fw-bold"},"Description",-1)),bs=["innerHTML"],vs={class:"row mt-3 g-1"},ks={class:"col-3 text-center selectable"},hs={class:"col-3 text-center selectable"},gs={class:"col-4 text-center selectable"},ms={class:"col-2 text-center selectable"},fs={class:"row"},ws={class:"col-12"},ys={class:"dark-blue-bg p-2"},ps={key:0,class:"bg-dark"},xs={key:0},Bs=c(()=>e("div",{class:"p-2"},"There are no clubs currently reading this book.",-1)),Rs=[Bs],Cs={key:1,class:"row py-2"},Ds={key:1,class:"bg-dark"},Ps={key:0},Is=c(()=>e("div",{class:"p-2"},"There are no clubs planning to read this book.",-1)),Us=[Is],Ts={key:1,class:"row py-2"},Ls={key:2,class:"bg-dark"},Ss={key:0},Ms=c(()=>e("div",{class:"p-2"},"There are no clubs finished reading this book.",-1)),Fs=[Ms],Vs={key:1,class:"row py-2"},As={key:3,class:"bg-dark"},Os={key:0},Es=c(()=>e("div",{class:"px-3 py-2"},[e("button",{class:"btn orange-btn",type:"button","data-bs-toggle":"collapse","data-bs-target":"#bookReviewForm","aria-expanded":"false","aria-controls":"bookReviewForm"}," Add Review ")],-1)),js={class:"collapse",id:"bookReviewForm"},Hs={class:"card mx-3"},qs={class:"card-body"},Gs={class:"row mb-3"},zs={class:"col-3 d-flex align-items-center"},Ns=["src","alt","title"],Js={class:"ms-2 fw-bold"},Ks=c(()=>e("div",{class:"col-5"},null,-1)),Qs={class:"col-4"},Ws=c(()=>e("div",{class:"my-0 ps-2 form-text"},"Recommendation",-1)),Xs={class:"d-flex align-items-center justify-content-around"},Ys={class:"me-2"},Zs=c(()=>e("option",{value:"Recommended"},"Recommend",-1)),$s=c(()=>e("option",{value:"Mixed Feelings"},"Mixed Feelings",-1)),et=c(()=>e("option",{value:"Not Recommended"},"Not Recommended",-1)),st=[Zs,$s,et],tt=c(()=>e("div",{class:""},[e("button",{type:"submit",class:"py-0 px-2 btn btn-sm btn-success"},[e("i",{class:"mdi mdi-send-circle-outline fs-4"})])],-1)),ot={class:"row"},it={class:"col-12"},at={key:1},nt=c(()=>e("div",{class:"p-2"},"There are no reviews for this book.",-1)),ct=[nt],dt={key:2,class:"pt-2"},lt={class:"mx-3 rounded dark-blue-bg"},rt={class:"p-3 text-light"},ut={class:"row mb-3"},_t={class:"col-3 d-flex align-items-center"},bt=["src","alt","title"],vt={class:"ms-2"},kt={class:"fw-bold"},ht={class:"text-secondary"},gt={class:"col-9 d-flex flex-column align-items-end"},mt={class:"d-flex align-items-center"},ft={key:0},wt={class:"d-flex align-items-center"},yt=c(()=>e("option",{value:"Recommended"},"Recommend",-1)),pt=c(()=>e("option",{value:"Mixed Feelings"},"Mixed Feelings",-1)),xt=c(()=>e("option",{value:"Not Recommended"},"Not Recommended",-1)),Bt=[yt,pt,xt],Rt={class:""},Ct=c(()=>e("i",{class:"mdi mdi-close-outline fs-4"},null,-1)),Dt=[Ct],Pt=c(()=>e("i",{class:"mdi mdi-check-outline fs-4"},null,-1)),It=[Pt],Ut={key:1},Tt={key:0},Lt={class:"px-2 d-flex align-items-center justify-content-center text-light light-blue-bg rounded"},St=c(()=>e("i",{class:"mdi mdi-star fs-4"},null,-1)),Mt={class:"ms-1"},Ft={key:1},Vt={class:"px-2 d-flex align-items-center justify-content-center text-light bg-secondary rounded"},At=c(()=>e("i",{class:"mdi mdi-star-half-full fs-4"},null,-1)),Ot={class:"ms-1"},Et={key:2},jt={class:"px-2 d-flex align-items-center justify-content-center text-dark bg-danger rounded"},Ht=c(()=>e("i",{class:"mdi mdi-star-outline fs-4"},null,-1)),qt={class:"ms-1"},Gt={key:2},zt={key:0,class:"d-flex"},Nt={class:"mx-2"},Jt=["onClick"],Kt=c(()=>e("i",{class:"mdi mdi-pencil-outline fs-4"},null,-1)),Qt=[Kt],Wt={class:""},Xt=["onClick"],Yt=c(()=>e("i",{class:"mdi mdi-trash-can-outline fs-4"},null,-1)),Zt=[Yt],$t={class:"row"},eo={class:"col-12"},so={key:0,class:"px-2"},to={key:1,class:"px-2"},oo=c(()=>e("div",{class:"fw-bold fs-5"},"Book Lists",-1)),io=c(()=>e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),ao={key:0},no=["id","onUpdate:modelValue"],co=["for"],lo={key:1},ro=["id","onUpdate:modelValue"],uo=["for"],_o=c(()=>e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1));function bo(f,t,k,s,m,x){const R=N("BookClubCard"),C=N("ModalBasic");return a(),n(B,null,[e("div",Le,[e("div",Se,[e("div",Me,[s.book?(a(),n("div",Fe,[e("div",Ve,[e("img",{class:"img-fluid book-img",src:s.book.imgUrlLarge,alt:""},null,8,Ae)]),e("div",Oe,[e("div",Ee,[e("div",je,_(s.book.title),1),e("div",He,_(s.book.subtitle),1),e("div",qe,[Ce("By "),e("span",null,_(s.book.author),1)]),e("div",Ge,[e("div",ze,[Ne,e("div",Je,_(s.bookScore),1),s.bookScoreUserCount==1?(a(),n("small",Ke,_(s.bookScoreUserCount)+" User",1)):(a(),n("small",Qe,_(s.bookScoreUserCount)+" Users",1))]),s.user.id?(a(),n("div",We,[e("div",Xe,[s.userHasThisBook?(a(),n("div",Ye,[Ze,p(e("select",{onChange:t[0]||(t[0]=o=>s.updateUserBookRating()),"onUpdate:modelValue":t[1]||(t[1]=o=>s.userBookData.rating=o),class:"fw-bold form-select form-select-sm ghost-bg border-0 rounded-start shadow-none selectable","aria-label":".form-select-sm rating"},[$e,(a(!0),n(B,null,P(s.ratingOptions,o=>(a(),n("option",{key:o.rating,value:o.rating},_(o.rating)+" - "+_(o.description),9,es))),128))],544),[[L,s.userBookData.rating]])])):w("",!0),s.userHasThisBook?(a(),n("div",ss,[ts,p(e("select",{onChange:t[2]||(t[2]=o=>s.updateUserBookStatus()),"onUpdate:modelValue":t[3]||(t[3]=o=>s.userBookData.status=o),class:"fw-bold form-select form-select-sm ghost-bg border-0 rounded-start shadow-none selectable","aria-label":".form-select-sm status"},ns,544),[[L,s.userBookData.status]])])):w("",!0),e("div",cs,[e("div",ds,[e("button",{onClick:t[4]||(t[4]=o=>s.openBookListsModal()),type:"button",class:"btn orange-btn"},rs)])])])])):w("",!0)]),e("div",us,[_s,e("small",{innerHTML:s.book.description,class:"pe-3"},null,8,bs)])])])])):w("",!0)])]),e("div",vs,[e("div",ks,[e("div",{class:S(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="reading","dark-blue-bg":s.selectedTab=="reading"}]),onClick:t[5]||(t[5]=o=>s.selectTab("reading"))},"Clubs Currently Reading",2)]),e("div",hs,[e("div",{class:S(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="planned","dark-blue-bg":s.selectedTab=="planned"}]),onClick:t[6]||(t[6]=o=>s.selectTab("planned"))},"Clubs Planning To Read",2)]),e("div",gs,[e("div",{class:S(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="finished","dark-blue-bg":s.selectedTab=="finished"}]),onClick:t[7]||(t[7]=o=>s.selectTab("finished"))},"Clubs Finished Reading",2)]),e("div",ms,[e("div",{class:S(["tab-text text-light px-2 pt-1",{"bg-dark":s.selectedTab!="reviews","dark-blue-bg":s.selectedTab=="reviews"}]),onClick:t[8]||(t[8]=o=>s.selectTab("reviews"))},"User Reviews",2)])]),e("div",fs,[e("div",ws,[e("div",ys,[s.selectedTab=="reading"?(a(),n("div",ps,[s.clubsReading.length?(a(),n("div",Cs,[(a(!0),n(B,null,P(s.clubsReading,o=>(a(),n("div",{key:o.id,class:"col-4"},[M(R,{clubProp:o},null,8,["clubProp"])]))),128))])):(a(),n("div",xs,Rs))])):s.selectedTab=="planned"?(a(),n("div",Ds,[s.clubsPlanned.length?(a(),n("div",Ts,[(a(!0),n(B,null,P(s.clubsPlanned,o=>(a(),n("div",{key:o.id,class:"col-4"},[M(R,{clubProp:o},null,8,["clubProp"])]))),128))])):(a(),n("div",Ps,Us))])):s.selectedTab=="finished"?(a(),n("div",Ls,[s.clubsFinished.length?(a(),n("div",Vs,[(a(!0),n(B,null,P(s.clubsFinished,o=>(a(),n("div",{key:o.id,class:"col-4"},[M(R,{clubProp:o},null,8,["clubProp"])]))),128))])):(a(),n("div",Ss,Fs))])):s.selectedTab=="reviews"?(a(),n("div",As,[s.user.id&&s.userHasThisBook&&!s.userReviewedStatus?(a(),n("div",Os,[Es,e("div",js,[e("div",Hs,[e("div",qs,[e("form",{onSubmit:t[11]||(t[11]=De(o=>s.createReview(),["prevent"]))},[e("div",Gs,[e("div",zs,[e("img",{class:"user-img",src:s.account.picture||s.user.picture,alt:s.user.name,title:s.user.name},null,8,Ns),e("div",Js,_(s.user.name),1)]),Ks,e("div",Qs,[Ws,e("div",Xs,[e("div",Ys,[p(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>s.userReviewData.rating=o),class:"form-select","aria-label":"Rating",required:""},st,512),[[L,s.userReviewData.rating]])]),tt])])]),e("div",ot,[e("div",it,[p(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=o=>s.userReviewData.content=o),class:"mb-2 pb-2 form-control",rows:"3",placeholder:"add review...",required:""},null,512),[[J,s.userReviewData.content]])])])],32)])])])])):w("",!0),s.userReviews.length?(a(),n("div",dt,[(a(!0),n(B,null,P(s.userReviews,(o,u)=>(a(),n("div",{key:u,class:"col-12 pb-2"},[e("div",lt,[e("div",rt,[e("div",ut,[e("div",_t,[e("img",{class:"user-img",src:o.creator.picture,alt:o.creator.name,title:o.creator.name},null,8,bt),e("div",vt,[e("div",kt,_(o.creator.name),1),e("small",ht,"Posted "+_(o.createdAt.toLocaleDateString("en-us",{year:"numeric",month:"short",day:"numeric"})),1)])]),e("div",gt,[e("div",mt,[s.reviewEditMode?(a(),n("div",ft,[e("div",wt,[e("div",null,[p(e("select",{"onUpdate:modelValue":t[12]||(t[12]=b=>s.userReviewData.rating=b),class:"form-select form-control input-sm","aria-label":"Rating",required:""},Bt,512),[[L,s.userReviewData.rating]])]),e("div",Rt,[e("button",{class:"mx-2 btn btn-sm btn-secondary py-0 px-2",onClick:t[13]||(t[13]=b=>s.cancelEditReview()),title:"Cancel Changes"},Dt),e("button",{class:"btn btn-sm btn-success py-0 px-2",onClick:t[14]||(t[14]=b=>s.updateReview()),title:"Save Changes"},It)])])])):(a(),n("div",Ut,[o.rating=="Recommended"?(a(),n("div",Tt,[e("div",Lt,[St,e("div",Mt,_(o.rating),1)])])):o.rating=="Mixed Feelings"?(a(),n("div",Ft,[e("div",Vt,[At,e("div",Ot,_(o.rating),1)])])):o.rating=="Not Recommended"?(a(),n("div",Et,[e("div",jt,[Ht,e("div",qt,_(o.rating),1)])])):w("",!0)])),s.reviewEditMode?w("",!0):(a(),n("div",Gt,[s.user.id==o.creatorId?(a(),n("div",zt,[e("div",Nt,[e("button",{class:"btn btn-sm btn-secondary py-0 px-2",onClick:b=>s.editReview(o),title:"Edit Review"},Qt,8,Jt)]),e("div",Wt,[e("button",{class:"btn btn-sm btn-danger py-0 px-2",onClick:b=>s.deleteReview(o),title:"Delete Review"},Zt,8,Xt)])])):w("",!0)]))])])]),e("div",$t,[e("div",eo,[s.reviewEditMode?(a(),n("div",so,[p(e("textarea",{"onUpdate:modelValue":t[15]||(t[15]=b=>s.userReviewData.content=b),class:"mb-2 pb-2 form-control",rows:"3",required:""},null,512),[[J,s.userReviewData.content]])])):(a(),n("div",to,_(o.content),1))])])])])]))),128))])):(a(),n("div",at,ct))])):w("",!0)])])])]),M(C,{id:"bookLists"},{header:V(()=>[oo,io]),body:V(()=>[(a(!0),n(B,null,P(s.bookListsOptions,(o,u,b)=>(a(),n("div",{key:b,class:"form-check"},[s.bookListsOptions[u].existsInBookList?(a(),n("div",ao,[p(e("input",{id:u,"onUpdate:modelValue":h=>s.bookListsOptions[u].selected=h,type:"checkbox",class:"form-check-input",checked:""},null,8,no),[[W,s.bookListsOptions[u].selected]]),e("label",{for:u,class:"form-check-label"},_(u)+" Books",9,co)])):(a(),n("div",lo,[p(e("input",{id:u,"onUpdate:modelValue":h=>s.bookListsOptions[u].selected=h,type:"checkbox",class:"form-check-input"},null,8,ro),[[W,s.bookListsOptions[u].selected]]),e("label",{for:u,class:"form-check-label"},_(u)+" Books",9,uo)]))]))),128))]),footer:V(()=>[_o,e("button",{onClick:t[16]||(t[16]=o=>s.updateBookLists()),type:"button",class:"btn btn-primary"},"Submit")]),_:1})],64)}const ko=ye(Te,[["render",bo],["__scopeId","data-v-8e93a643"]]);export{ko as default};
